<ion-view title="Promise Tracker">
  <ion-content class="has-header has-home-footer" overflow-scroll="true">
    <div class="section-title home-header">
      <icon class="ion-clipboard"></icon> {{ 'MY_CAMPAIGNS' | translate }}
    </div>
    <div class="padding unpad-top">
      <button class="button button-block button-calm" ng-click="openCodeModal()"><icon class="ion-plus-circled"></icon> {{ 'GET_CAMPAIGN' | translate}}</button>
    </div>
    <ion-list id="surveys-list">
      <ion-item ng-repeat="survey in surveys" item="survey" can-swipe="true">
        <div class="button button-clear right" ng-show="{{survey.status == 'test'}}" ng-click="fetchSurvey(survey)">
          <icon class="ion-loop right"></icon>
        </div>
        <div class="survey-info">
          <a href="#/surveys/{{survey.id}}/start">
            <h4 class="survey-title">{{survey.title}}</h4>

            <span class="sub-line" ng-show="{{survey.status !== 'test' && survey.sensorType == 'none'}}">{{ 'RESPONSES_TO_DATE' | translate : "{NUM: countSynced(survey.id)}" : "messageformat" }}</span>

            <p class="sub-line" ng-show="{{survey.sensorType !== 'none'}}"><icon class="ion-radio-waves"></icon> Sensor campaign</p>
            <p class="sub-line">
              <span ng-show="{{data.pairedDevice.surveyId && data.pairedDevice.surveyId == survey.id}}">
                Paired sensor: {{data.pairedDevice.uuid}}<br>
                Latest reading: <strong>{{data.pairedDevice.latestReading}}</strong> dBA
              </span>
            </p>
          </a>
          <span ng-show="{{!data.pairedDevice.surveyId || data.pairedDevice.surveyId != survey.id}}">
            <button class="button button-calm-outline" ng-click="pairSensor(survey.id)">Pair sensor</button>
          </span>
        </div>

        <!-- Swipe options -->
        <ion-option-button class="button button-calm" ng-click="viewMap(survey.id)">
          <icon class="ion-map"></icon>
        </ion-option-button>
        <ion-option-button class="button button-pink" ng-click="deleteSurvey(survey.id)">
          <icon class="ion-close"></icon>
        </ion-option-button>
      </ion-item>
    </ion-list>

    <!-- Intro text for new users -->
    <div class="padding center subtle" ng-show="surveyCount == 0" id="intro-text">
      <h4>{{ 'GREETING' | translate }}</h4>
      <p class="get-started">{{ 'GET_STARTED' | translate }}</p>
    </div>
  </ion-content>
  <!-- <div class="bar home bar-footer">
    <div id="status">
      <div ng-show="data.isSyncing">
        <p>
          <icon class="ion-looping"></icon> {{ 'SYNCING' | translate }}
        </p>
      </div>
      <div ng-show="!data.isSyncing && data.needsSync" class="alert">
        <p>
          {{ 'UNSYNCED_RESPONSES' | translate : "{NUM: countSynced(survey.id)}" : "messageformat" }}
          <button class="button button-bare sync-button" ng-click="syncSurveys()">{{ 'SYNC_NOW' | translate }}<icon class="ion-loop"></icon></button>
        </p>
      </div>
      <div ng-show="!data.isSyncing && responseCount > 0" class="all-synced">
        <i class="icon ion-checkmark"></i> {{ 'ALL_SYNCED' | translate }}
      </div>
    </div>
    <div class="bar bar-menu nav-menu">
      <a href="#/user">
        <button class="button button-icon ion-person"></button>
      </a>
      <a href="#/home" class="selected">
        <button class="button button-icon ion-clipboard"></button>
      </a>
      <a href="#/sensors">
        <button class="button button-icon ion-radio-waves"></button>
      </a>
    </div>
  </div> -->
</ion-view>

<!-- Enter code modal -->
<script id="enter-code.html" type="text/ng-template">
  <div class="modal">
    <ion-header-bar class="bar-secondary">
      <h1 class=title>{{ 'CAMPAIGN_CODE' | translate }}</h1>
      <span class="top-right action cancel-button" ng-click="closeCodeModal()"><icon class="ion-close"></icon></span>
    </ion-header-bar>

    <ion-content>
      <form ng-submit="fetchSurvey(survey)">
        <p class="center help-text">{{ 'CAMPAIGN_CODE_PROMPT' | translate }}:</p>
        <div class="list">
          <label class="item item-input enter-code-input">
            <input type="tel" ng-model="survey.code" ui-mask="999-999">
          </label>
        </div>
        <div ng-if="errorMessage.length > 0" class="padding error-message">
          <p>{{ errorMessage | translate }}</p>
        </div>
        <div class="padding unpad-top">
          <button type="submit" class="button button-block button-calm">
            <icon ng-if="surveyLoading" class="ion-loading-c"></icon>
            <span ng-if="!surveyLoading">{{ 'DOWNLOAD' | translate }}</span>
          </button>
        </div>
      </form>
      <div class="padding subtle small center unpad-top">
        <p class="get-started">{{ 'CODE_TIP' | translate }}</p>
      </div>
    </ion-content>
  </div>
</script>

<!-- Pair bluetooth modal -->
<script id="pair-device.html" type="text/ng-template">
  <div class="modal">
    <ion-header-bar class="bar-secondary">
      <h1 class=title>Pair a sensor</h1>
      <span class="top-right action cancel-button" ng-click="closePairModal()"><icon class="ion-close"></icon></span>
    </ion-header-bar>

    <ion-content>
      <div class="padding center">
        <h5>Scan bluetooth devices to find your sensor</h5>

        <button class="button button-block button-calm" ng-click="scanBLE()">
          Rescan
        </button>
      </div>

      <ion-list id="devices-list">
        <ion-item ng-repeat="device in data.devices" item="device" can-swipe="false">
          <div ng-click="pairDevice(device)">
            <a class="button button-clear right">
              Pair
            </a>
            <h4 class="survey-title">{{device.name}}</h4>
            <h6>{{device.uuid}}</h6>
          </div>
        </ion-item>
      </ion-list>
    </ion-content>
  </div>
</script>